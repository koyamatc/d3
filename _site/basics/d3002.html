<!DOCTYPE html>
<html lang="jp">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" CONTENT="IE=EmulateIE7" />
  <title>d3</title>
  <!-- Le styles -->
  <link href="/css/bootstrapx.css" rel="stylesheet">
  <link href="/css/bootstrap-glyphicons.css" rel="stylesheet">
  <link href="/css/logo.css" rel="stylesheet">
  <link href="/css/jklmain.css" rel="stylesheet">
  <link href="/css/monokai.css" rel="stylesheet">
  <link href="/css/d3.css" rel="stylesheet">
</head>
<body>
  <div class="container">
        <div class="row">
      <div class="col-sm-5 col-md-5">
        <div id="logo"><span>koyamatch.com</span></div>
      </div>
      <div class="col-sm-7 col-md-7">
        <h1 id="subtitle" class="text-right">d3</h1>
        <div class="row">
          <div class="col-md-4"></div>
          <div class="col-md-offset-4">
          <a href="/"><h4><span class="glyphicon glyphicon-home text-white"> home</span></h4></a>
          </div>
        </div>  
      </div>
    </div><!--/row-->

    
    <h2>SVGの基本</h2>
<p class="meta">30 May 2014</p>

<div class="post">
<h3 id="toc_0">SVG要素をwebページに追加する</h3>

<div class="highlight"><pre><code class="javascript"><span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">&quot;#ins01&quot;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;svg&quot;</span><span class="p">)</span>
                   <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;width&quot;</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
                   <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
                   <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;circle&quot;</span><span class="p">)</span>
                   <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;cx&quot;</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
                   <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;cy&quot;</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
                   <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
                   <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">&quot;fill&quot;</span><span class="p">,</span> <span class="s2">&quot;lime&quot;</span><span class="p">);</span>
</code></pre></div>
          

<p>まずは実行してみます</p>

<p><button id="btn01" class="btn btn-info">実行</button>
<div id="ins01"></div></p>

<p><strong>Style Operator</strong></p>

<div class="highlight"><pre><code class="javascript"><span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">&quot;fill&quot;</span><span class="p">,</span><span class="s2">&quot;lime&quot;</span><span class="p">)</span>
</code></pre></div>

<p>styleオペレータは、選択されている要素にCSSのスタイルを適用します。</p>

<p><strong>Selections as JavaScript Variables</strong></p>

<div class="highlight"><pre><code class="javascript"><span class="c1">// 挿入先を選択</span>
<span class="kd">var</span> <span class="nx">insSelection</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">&quot;#ins02&quot;</span><span class="p">);</span>
<span class="c1">// 挿入先にsvg要素を追加し、そのsvg要素を選択</span>
<span class="kd">var</span> <span class="nx">svgSelection</span> <span class="o">=</span> <span class="nx">insSelection</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;svg&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;width&quot;</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">,</span> <span class="mi">50</span><span class="p">);</span>
<span class="c1">// svg要素に円を追加 </span>
<span class="kd">var</span> <span class="nx">circleSelection</span> <span class="o">=</span> <span class="nx">svgSelection</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;circle&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;cx&quot;</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;cy&quot;</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">&quot;fill&quot;</span><span class="p">,</span> <span class="s2">&quot;lime&quot;</span><span class="p">);</span>
</code></pre></div>
          

<p>D3.jsが返してくるセレクションを、JavaScript変数に割り当てることができます。</p>

<p><button id="btn02" class="btn btn-info">実行</button>
<div id="ins02"></div></p>

<p><strong>SVG Circle要素</strong></p>

<p>SVG Circle要素は、基本のSVG形要素です。 基本の形要素は、SVGですでに定義されている標準の形です。 </p>

<p>注　pathを使って計算で再作成することもできます。</p>

<ul>
<li>cx - 円の中心のx座標</li>
<li>cy - 円の中心のy座標</li>
<li>r - 円の半径</li>
</ul>

<h3 id="toc_1">データに基づいたSVG要素をウェッブページに追加</h3>

<div class="highlight"><pre><code class="javascript"><span class="c1">//　SVG円へ変換するためにバインドしたデータを使う</span>
<span class="kd">var</span> <span class="nx">circleRadii</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;r&quot;</span><span class="o">:</span><span class="mi">40</span><span class="p">,</span><span class="s2">&quot;color&quot;</span><span class="o">:</span><span class="s2">&quot;white&quot;</span><span class="p">},</span>
                   <span class="p">{</span><span class="s2">&quot;r&quot;</span><span class="o">:</span><span class="mi">20</span><span class="p">,</span><span class="s2">&quot;color&quot;</span><span class="o">:</span><span class="s2">&quot;gold&quot;</span><span class="p">},</span>
                   <span class="p">{</span><span class="s2">&quot;r&quot;</span><span class="o">:</span><span class="mi">10</span><span class="p">,</span><span class="s2">&quot;color&quot;</span><span class="o">:</span><span class="s2">&quot;orange&quot;</span><span class="p">},</span>
                   <span class="p">{</span><span class="s2">&quot;r&quot;</span><span class="o">:</span><span class="mi">50</span><span class="p">,</span><span class="s2">&quot;color&quot;</span><span class="o">:</span><span class="s2">&quot;green&quot;</span><span class="p">}</span>
                  <span class="p">];</span>

<span class="kd">var</span> <span class="nx">svgContainer</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">&quot;#ins03&quot;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;svg&quot;</span><span class="p">)</span>
                                    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;width&quot;</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>
                                    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">circles</span> <span class="o">=</span> <span class="nx">svgContainer</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s2">&quot;circle&quot;</span><span class="p">)</span>
                          <span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">circleRadii</span><span class="p">)</span>
                          <span class="p">.</span><span class="nx">enter</span><span class="p">()</span>
                          <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;circle&quot;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">circleAttributes</span> <span class="o">=</span> <span class="nx">circles</span>
                       <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;cx&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span><span class="nx">i</span><span class="p">){</span> <span class="k">return</span> <span class="nx">i</span><span class="o">*</span><span class="mi">80</span><span class="o">+</span><span class="mi">50</span><span class="p">;</span> <span class="p">}})</span>
                       <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;cy&quot;</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
                       <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">d</span><span class="p">.</span><span class="nx">r</span><span class="p">;</span> <span class="p">})</span>
                       <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">&quot;fill&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">d</span><span class="p">.</span><span class="nx">color</span><span class="p">;</span> <span class="p">});</span>
</code></pre></div>

<p><button id="btn03" class="btn btn-info">実行</button>
<div id="ins03"></div></p>

<div class="highlight"><pre><code class="javascript"> <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;cx&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span><span class="nx">i</span><span class="p">){</span> <span class="k">return</span> <span class="nx">i</span><span class="o">*</span><span class="mi">80</span><span class="o">+</span><span class="mi">50</span><span class="p">;</span> <span class="p">}})</span> <span class="c1">// 関数で値を指定　</span>
   <span class="c1">//function(d,i)  d:バインドしたデータ　i:バインドしたデータの指標</span>
 <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;cy&quot;</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span> <span class="c1">// 直接値を指定</span>
 <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">d</span><span class="p">.</span><span class="nx">r</span><span class="p">;</span> <span class="p">})</span><span class="err">　</span><span class="c1">// d.r バインドしたデータの要素rの値</span>
 <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">&quot;fill&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">d</span><span class="p">.</span><span class="nx">color</span><span class="p">;</span> <span class="p">});</span> <span class="c1">// d.color バインドしたデータの要素colorの値</span>
</code></pre></div>

<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>

<script>
// button01
d3.select("#btn01").on("click", function(){

  d3.select("#ins01").append("svg")
                   .attr("width", 50)
                   .attr("height", 50)
                   .append("circle")
                   .attr("cx", 25)
                   .attr("cy", 25)
                   .attr("r", 25)
                   .style("fill", "lime");
});

// button2
d3.select("#btn02").on("click", function(){

  var insSelection = d3.select("#ins02");
 
  var svgSelection = insSelection.append("svg")
                                 .attr("width", 50)
                                 .attr("height", 50);
 
  var circleSelection = svgSelection.append("circle")
                                 .attr("cx", 25)
                                 .attr("cy", 25)
                                 .attr("r", 25)
                                 .style("fill", "lime");

});

// button3
d3.select("#btn03").on("click", function(){

  //　SVG円へ変換するためにバインドしたデータを使う
  var circleRadii = [{"r":40,"color":"white"},
                     {"r":20,"color":"gold"},
                     {"r":10,"color":"aqua"},
                     {"r":30,"color":"green"}
                    ];

  var svgContainer = d3.select("#ins03").append("svg")
                                    .attr("width", 400)
                                    .attr("height", 200);

  var circles = svgContainer.selectAll("circle")
                          .data(circleRadii)
                          .enter()
                          .append("circle");

  var circleAttributes = circles
                       .attr("cx", function(d,i){ return i*80 +50 ; })
                       .attr("cy", 50)
                       .attr("r", function (d) { return d.r; })
                       .style("fill", function (d) { return d.color; });

});

</script>        

</div>

 
        <div class="row">
      <footer>
        <hr>
        <div class="col-sm-8">
          <p>&copy;koyamatc@koyamatch.com since 2002</p>
        </div>
        <div class="col-sm-2">
          <p><a href="https://github.com/koyamatc">github.com/koyamatc</a></p>
        </div>
        <div class="col-sm-2">
          <p><a href="https://www.facebook.com/koyamatc">www.facebook.com/koyamatc</a></p>
        </div>
      </footer>
    </div>

  </div><!-- container -->

  <!-- JavaScript Libraries -->
  <script src="/js/jquery.js"></script>
  <script src="/js/bootstrap.js"></script>
  <script src="/js/jquery.lettering-0.6.1.min.js"></script>
  <script src="/js/logo.js"></script>
</body>
</html>

