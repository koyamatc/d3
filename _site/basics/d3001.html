<!DOCTYPE html>
<html lang="jp">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" CONTENT="IE=EmulateIE7" />
  <title>d3</title>
  <!-- Le styles -->
  <link href="/css/bootstrapx.css" rel="stylesheet">
  <link href="/css/bootstrap-glyphicons.css" rel="stylesheet">
  <link href="/css/logo.css" rel="stylesheet">
  <link href="/css/jklmain.css" rel="stylesheet">
  <link href="/css/monokai.css" rel="stylesheet">
  <link href="/css/d3.css" rel="stylesheet">
</head>
<body>
  <div class="container">
        <div class="row">
      <div class="col-sm-5 col-md-5">
        <div id="logo"><span>koyamatch.com</span></div>
      </div>
      <div class="col-sm-7 col-md-7">
        <h1 id="subtitle" class="text-right">d3</h1>
        <div class="row">
          <div class="col-md-4"></div>
          <div class="col-md-offset-4">
          <a href="/"><h4><span class="glyphicon glyphicon-home text-white"> home</span></h4></a>
          </div>
        </div>  
      </div>
    </div><!--/row-->

    
    <h2>DOMの基本</h2>
<p class="meta">31 May 2014</p>

<div class="post">
<h3 id="toc_0">DOM要素をwebページに追加する</h3>

<div class="highlight"><pre><code class="html"><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;ins01&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
</code></pre></div>

<div class="highlight"><pre><code class="javascript"><span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">&quot;#ins01&quot;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;div&quot;</span><span class="p">);</span>
</code></pre></div>

<p><button id="btn01" class="btn btn-info">実行</button>
<div id="ins01"></div></p>

<hr>

<p><strong>Select Method</strong></p>

<div class="highlight"><pre><code class="javascript"><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">&quot;#ins01&quot;</span><span class="p">)</span>
</code></pre></div>

<ul>
<li><p>CSS3のセレクタを使いDOM要素を選択します。 </p></li>
<li><p>選択した要素に対して、命令を実行できます。</p></li>
</ul>

<p><strong>Append Operator</strong></p>

<div class="highlight"><pre><code class="javascript"><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;div&quot;</span><span class="p">)</span>
</code></pre></div>

<ul>
<li>現在選択されている要素の最後に新しい要素を追加します。</li>
</ul>

<h3 id="toc_1">データをDOM要素に結び付る</h3>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">theData</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span> <span class="p">];</span>

<span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">&quot;#ins02&quot;</span><span class="p">).</span><span class="nx">selectAll</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">)</span>
           <span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">theData</span><span class="p">)</span>
           <span class="p">.</span><span class="nx">enter</span><span class="p">()</span>
           <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">)</span>
           <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;Hi &quot;</span><span class="p">);</span>
</code></pre></div>

<p><button id="btn02" class="btn btn-info">実行</button>
<div id="ins02"></div></p>

<p><strong>SelectAll Method</strong></p>

<div class="highlight"><pre><code class="javascript"><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">)</span>
</code></pre></div>

<p>Hi が３回表示されました。</p>

<ul>
<li><p>selectメソッドが最初の要素を取得するのに対し、selectAllメソッドは、適合するすべての要素を取得します。</p></li>
<li><p>&#39;#ins02&#39;には最初　p要素はありません、結果 .selectAll(&quot;p&quot;)は、空のセレクションを返します。</p></li>
<li><p>その後の.data(theData) と　.enter() が空のセレクションにデータを結びつけます。</p></li>
</ul>

<p><strong>Data Operator</strong></p>

<div class="highlight"><pre><code class="javascript"><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">theData</span><span class="p">)</span>
</code></pre></div>

<p>dataオペレータは、配列のデータ（数字、オブジェクト、他の配列）をセレクションに結び付けます。</p>

<p>この例では、キーが無いので、配列データ（theData）の各要素は、セレクションの各要素に割り当てられます。１は最初の&lt;p&gt;要素に、2は２番目の要素に、3は３番目の要素に。</p>

<p>しかし、まだ&lt;p&gt;要素はページ上にありません。どうなっているのでしょう？</p>

<p>　
<strong>Virtual Selections</strong></p>

<p>他のメソッドが通常１つのセレクションを返すのに対し、 dataオペレータは、３つの仮想セレクションを返します。</p>

<p>それは、enter,update,exitです。</p>

<ul>
<li><p><em>enter</em> : データに対して不足している要素の置き場所を持ちます。</p></li>
<li><p><em>update</em>: データに結び付いた存在する要素を持ちます。</p></li>
<li><p><em>exit</em> : データに対して余った要素を持ちます。</p></li>
</ul>

<p>d3.select(&quot;#ins01&quot;).selectAll(&quot;p&quot;)は空でした。 enterセレクションは、不足している&lt;p&gt;要素の置き場所を保持しています。</p>

<p><strong>Enter Method</strong></p>

<p>enterメソッドは、dataオペレータから、仮想enterセレクションを返します。 このメソッドはdataオペレータに対してだけ働きます、なぜなら、dataオペレータだけが３つの仮想セレクションを返すからです。</p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">&quot;#ins02&quot;</span><span class="p">).</span><span class="nx">selectAll</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">theData</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">enter</span><span class="p">()</span>
</code></pre></div>

<p>この場合、対応するDOM要素が存在していないデータの各要素のために、 置き場としての要素（ノード）への参照を返します。</p>

<p>一度参照できれば、その要素に対して操作ができます。</p>

<p>しかし、この参照は要素に対して、append、insert、selectオペレータを使えるということです。</p>

<p>.enter()セレクションにこれらのオペレータを実行することで、 この要素を扱えます。</p>

<p><strong>Append Operator Revisited</strong></p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">&quot;#ins02&quot;</span><span class="p">).</span><span class="nx">selectAll</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">theData</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">enter</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">)</span>
</code></pre></div>
          

<p>enter()セレクションに対して　.append(&quot;p&quot;)を実行します。</p>

<p>前のステップで作成された不足分の置き場所に、p要素が挿入されます。</p>

<p>データ配列に3つのデータがあり、ウェッブページにはp要素はないので、 .append(&quot;p&quot;)は、３つのp要素を作成し追加します。</p>

<p>例では、appendオペレタが実行された後、3つのp要素を返します。</p>

<p><strong>Text Operator</strong></p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">&quot;#ins02&quot;</span><span class="p">).</span><span class="nx">selectAll</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">theData</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">enter</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;Hi&quot;</span><span class="p">)</span>
</code></pre></div>
          

<p>textオペレータは、選択されたすべての要素のテキストコンテントに指定された値を設定します。</p>

<p>例では、.text(&quot;Hi&quot;)で、その値は &quot;Hi&quot;です。 3つの&lt;p&gt;要素が選択されているので、各要素は&quot;Hi&quot;をその中に取り込みます。</p>

<p><em>データはどこへいった？</em></p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">theData</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
</code></pre></div>

<p>JavaScriptのデータ配列で始まったこの例は、&quot;Hi&quot; を表示する3つのパラグラフで終了しています。</p>

<p>１、２、３はどうしたのでしょうか？</p>

<p><em>データ オペレータをもう一度</em></p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">theData</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span> <span class="p">];</span>

<span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">&quot;#ins01&quot;</span><span class="p">).</span><span class="nx">selectAll</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">theData</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">enter</span><span class="p">()</span>
      <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;Hi &quot;</span><span class="p">);</span>

   <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">p</span><span class="p">);</span> 
    
    <span class="c1">// JavaScript Console</span>
    <span class="nb">Array</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="mi">0</span><span class="o">:</span> <span class="nx">HTMLParagraphElement</span>
    <span class="mi">1</span><span class="o">:</span> <span class="nx">HTMLParagraphElement</span>
    <span class="mi">2</span><span class="o">:</span> <span class="nx">HTMLParagraphElement</span>
      <span class="nx">__data__</span><span class="o">:</span> <span class="mi">3</span>
      <span class="nx">align</span><span class="o">:</span> <span class="s2">&quot;&quot;</span>
      <span class="nx">attributes</span><span class="o">:</span> <span class="nx">NamedNodeMap</span>
</code></pre></div>
          

<p>上記を実行すると、コンソールに、3つのp要素が追加されています。</p>

<p>3つ目の要素を開くと、中にプロパティ名__data__ 値３があります。</p>

<p>データが要素に割り当てられると、データはプロパティ__data__に保存されます。</p>

<p>このことがデータを__data__プロパティにくっつけて利用できるようにしています。</p>

<p>これが、データをDOM要素につなげると言うことです。</p>

<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>

<script>
    // button01 
    d3.select("#btn01").on("click", function(){
        d3.select("#ins01").append("div");
    });

    // button02
    d3.select("#btn02").on("click", function(){

      var theData = [ 1, 2, 3 ];

      var p = d3.select("#ins02").selectAll("p")
                .data(theData)
                .enter()
                .append("p")
                .text("Hi ");

    });

</script>

</div>

 
        <div class="row">
      <footer>
        <hr>
        <div class="col-sm-8">
          <p>&copy;koyamatc@koyamatch.com since 2002</p>
        </div>
        <div class="col-sm-2">
          <p><a href="https://github.com/koyamatc">github.com/koyamatc</a></p>
        </div>
        <div class="col-sm-2">
          <p><a href="https://www.facebook.com/koyamatc">www.facebook.com/koyamatc</a></p>
        </div>
      </footer>
    </div>

  </div><!-- container -->

  <!-- JavaScript Libraries -->
  <script src="/js/jquery.js"></script>
  <script src="/js/bootstrap.js"></script>
  <script src="/js/jquery.lettering-0.6.1.min.js"></script>
  <script src="/js/logo.js"></script>
</body>
</html>

